<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- PWA Settings -->
    <meta name="theme-color" content="#2a5298">
    <meta name="description" content="FHC Thonnakkal Monthly Health Report Application">
    <link rel="manifest" href="./manifest.json">
    <link rel="icon" type="image/svg+xml" href="./icons/icon.svg">
    <link rel="apple-touch-icon" href="./icons/icon.svg">
    <title>Monthly Health Report - FHC THONNAKKAL</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .form-content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 25px;
            background: linear-gradient(to bottom, #ffffff 0%, #f8f9fa 100%);
            transition: all 0.3s ease;
        }

        .section:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .section-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #2a5298;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            text-transform: uppercase;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th,
        td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.9em;
            letter-spacing: 1px;
        }

        tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        tr:hover {
            background-color: #e9ecef;
            transition: background-color 0.2s ease;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            /* Prevents iOS zoom */
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        input[readonly] {
            background-color: #f0f0f0;
            font-weight: bold;
            color: #2a5298;
            cursor: not-allowed;
        }

        .total-row {
            background-color: #fff3cd !important;
            font-weight: bold;
        }

        .grand-total-row {
            background-color: #d1ecf1 !important;
            font-weight: bold;
            font-size: 1.1em;
        }

        .button-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 16px 32px;
            font-size: 1.1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            min-width: 150px;
            min-height: 48px;
            touch-action: manipulation;
        }

        .btn-print {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-print:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(17, 153, 142, 0.4);
        }

        .btn-reset {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
            color: white;
        }

        .btn-reset:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(235, 51, 73, 0.4);
        }

        .btn-calculate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-calculate:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .month-year {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .month-year div {
            flex: 1;
            min-width: 200px;
        }

        .month-year label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2a5298;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .container {
                box-shadow: none;
                border-radius: 0;
            }

            .button-container {
                display: none;
            }

            .section {
                page-break-inside: avoid;
            }

            input {
                border: none;
                background: transparent;
            }
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 10px;
            }

            .form-content {
                padding: 20px 15px;
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 1.4em;
                line-height: 1.3;
            }

            .header p {
                font-size: 1em;
            }

            .section {
                padding: 15px;
                margin-bottom: 25px;
            }

            .section-title {
                font-size: 1.2em;
                margin-bottom: 15px;
            }

            table {
                font-size: 0.85em;
                display: block;
                overflow-x: auto;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch;
                table-layout: fixed;
            }

            thead,
            tbody,
            tr {
                display: table;
                width: 100%;
                table-layout: fixed;
            }

            th,
            td {
                padding: 10px 6px;
                width: auto;
                min-width: 80px;
                max-width: 80px;
            }

            /* First column (Category) should be slightly wider but not too much */
            th:first-child,
            td:first-child {
                min-width: 100px;
                max-width: 100px;
                font-size: 0.8em;
            }

            input[type="text"],
            input[type="number"] {
                padding: 12px 8px;
                font-size: 16px !important;
                min-height: 44px;
            }

            .month-year {
                gap: 15px;
            }

            .month-year div {
                min-width: 100%;
                flex: 1 1 100%;
            }

            button {
                width: 100%;
                max-width: 100%;
                padding: 14px 20px;
                font-size: 1em;
                min-height: 48px;
            }

            .button-container {
                gap: 10px;
                padding: 0;
            }

            .section::after {
                content: '‚Üê Scroll table horizontally ‚Üí';
                display: block;
                text-align: center;
                color: #999;
                font-size: 0.75em;
                padding: 8px;
                font-style: italic;
                margin-top: 10px;
            }

            table::-webkit-scrollbar {
                height: 8px;
            }

            table::-webkit-scrollbar-track {
                background: #f1f1f1;
                border-radius: 4px;
            }

            table::-webkit-scrollbar-thumb {
                background: #667eea;
                border-radius: 4px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }

            .header h1 {
                font-size: 1.2em;
            }

            .header p {
                font-size: 0.9em;
            }

            .section {
                padding: 12px;
            }

            .section-title {
                font-size: 1.1em;
            }

            table {
                font-size: 0.8em;
            }

            th,
            td {
                padding: 8px 4px;
                min-width: 50px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Monthly Health Report</h1>
            <p>FHC THONNAKKAL</p>
        </div>

        <div class="form-content">
            <div class="month-year">
                <div>
                    <label for="reportMonth">Month:</label>
                    <select id="reportMonth">
                        <option value="JANUARY">JANUARY</option>
                        <option value="FEBRUARY">FEBRUARY</option>
                        <option value="MARCH">MARCH</option>
                        <option value="APRIL">APRIL</option>
                        <option value="MAY">MAY</option>
                        <option value="JUNE">JUNE</option>
                        <option value="JULY">JULY</option>
                        <option value="AUGUST">AUGUST</option>
                        <option value="SEPTEMBER">SEPTEMBER</option>
                        <option value="OCTOBER">OCTOBER</option>
                        <option value="NOVEMBER">NOVEMBER</option>
                        <option value="DECEMBER" selected>DECEMBER</option>
                    </select>
                </div>
                <div>
                    <label for="reportYear">Year:</label>
                    <input type="number" id="reportYear" placeholder="e.g., 2026" value="2026">
                </div>
            </div>

            <!-- OP CENSUS Section -->
            <div class="section">
                <div class="section-title">OP Census</div>
                <table>
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Male</th>
                            <th>Female</th>
                            <th>Children</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>New OP</strong></td>
                            <td><input type="number" class="op-input" data-row="new" data-col="male" value="0" min="0">
                            </td>
                            <td><input type="number" class="op-input" data-row="new" data-col="female" value="0"
                                    min="0"></td>
                            <td><input type="number" class="op-input" data-row="new" data-col="children" value="0"
                                    min="0"></td>
                            <td><input type="number" class="op-total" data-row="new" readonly value="0"></td>
                        </tr>
                        <tr>
                            <td><strong>Old OP</strong></td>
                            <td><input type="number" class="op-input" data-row="old" data-col="male" value="0" min="0">
                            </td>
                            <td><input type="number" class="op-input" data-row="old" data-col="female" value="0"
                                    min="0"></td>
                            <td><input type="number" class="op-input" data-row="old" data-col="children" value="0"
                                    min="0"></td>
                            <td><input type="number" class="op-total" data-row="old" readonly value="0"></td>
                        </tr>
                        <tr>
                            <td><strong>Morning OP</strong></td>
                            <td><input type="number" class="op-input" data-row="morning" data-col="male" value="0"
                                    min="0"></td>
                            <td><input type="number" class="op-input" data-row="morning" data-col="female" value="0"
                                    min="0"></td>
                            <td><input type="number" class="op-input" data-row="morning" data-col="children" value="0"
                                    min="0"></td>
                            <td><input type="number" class="op-total" data-row="morning" readonly value="0"></td>
                        </tr>
                        <tr>
                            <td><strong>Evening OP</strong></td>
                            <td><input type="number" class="op-input" data-row="evening" data-col="male" value="0"
                                    min="0"></td>
                            <td><input type="number" class="op-input" data-row="evening" data-col="female" value="0"
                                    min="0"></td>
                            <td><input type="number" class="op-input" data-row="evening" data-col="children" value="0"
                                    min="0"></td>
                            <td><input type="number" class="op-total" data-row="evening" readonly value="0"></td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>TOTAL</strong></td>
                            <td><input type="number" id="opMaleTotal" readonly value="0"></td>
                            <td><input type="number" id="opFemaleTotal" readonly value="0"></td>
                            <td><input type="number" id="opChildrenTotal" readonly value="0"></td>
                            <td><input type="number" id="opGrandTotal" readonly value="0"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- STAFF STRENGTH Section -->
            <div class="section">
                <div class="section-title">Staff Strength</div>
                <table>
                    <thead>
                        <tr>
                            <th>Category of Staff</th>
                            <th>Sanctioned Post</th>
                            <th>In Position</th>
                            <th>Vacancy</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Nursing Officer Grade 1</strong></td>
                            <td><input type="number" class="staff-input" data-row="no1" data-col="sanctioned" value="0"
                                    min="0"></td>
                            <td><input type="number" class="staff-input" data-row="no1" data-col="position" value="0"
                                    min="0"></td>
                            <td><input type="number" class="staff-vacancy" data-row="no1" readonly value="0"></td>
                        </tr>
                        <tr>
                            <td><strong>Nursing Officer</strong></td>
                            <td><input type="number" class="staff-input" data-row="no" data-col="sanctioned" value="0"
                                    min="0"></td>
                            <td><input type="number" class="staff-input" data-row="no" data-col="position" value="0"
                                    min="0"></td>
                            <td><input type="number" class="staff-vacancy" data-row="no" readonly value="0"></td>
                        </tr>
                        <tr>
                            <td><strong>Nursing Officer LSGD</strong></td>
                            <td><input type="number" class="staff-input" data-row="lsgd" data-col="sanctioned" value="0"
                                    min="0"></td>
                            <td><input type="number" class="staff-input" data-row="lsgd" data-col="position" value="0"
                                    min="0"></td>
                            <td><input type="number" class="staff-vacancy" data-row="lsgd" readonly value="0"></td>
                        </tr>
                        <tr>
                            <td><strong>Nursing Officer NHM</strong></td>
                            <td><input type="number" class="staff-input" data-row="nonhm" data-col="sanctioned"
                                    value="0" min="0"></td>
                            <td><input type="number" class="staff-input" data-row="nonhm" data-col="position" value="0"
                                    min="0"></td>
                            <td><input type="number" class="staff-vacancy" data-row="nonhm" readonly value="0"></td>
                        </tr>
                        <tr>
                            <td><strong>Nursing Assistant</strong></td>
                            <td><input type="number" class="staff-input" data-row="na" data-col="sanctioned" value="0"
                                    min="0"></td>
                            <td><input type="number" class="staff-input" data-row="na" data-col="position" value="0"
                                    min="0"></td>
                            <td><input type="number" class="staff-vacancy" data-row="na" readonly value="0"></td>
                        </tr>
                        <tr>
                            <td><strong>Grade II</strong></td>
                            <td><input type="number" class="staff-input" data-row="g2" data-col="sanctioned" value="0"
                                    min="0"></td>
                            <td><input type="number" class="staff-input" data-row="g2" data-col="position" value="0"
                                    min="0"></td>
                            <td><input type="number" class="staff-vacancy" data-row="g2" readonly value="0"></td>
                        </tr>
                        <tr>
                            <td><strong>Grade II HMC</strong></td>
                            <td><input type="number" class="staff-input" data-row="g2hmc" data-col="sanctioned"
                                    value="0" min="0"></td>
                            <td><input type="number" class="staff-input" data-row="g2hmc" data-col="position" value="0"
                                    min="0"></td>
                            <td><input type="number" class="staff-vacancy" data-row="g2hmc" readonly value="0"></td>
                        </tr>
                        <tr>
                            <td><strong>PTS</strong></td>
                            <td><input type="number" class="staff-input" data-row="pts" data-col="sanctioned" value="0"
                                    min="0"></td>
                            <td><input type="number" class="staff-input" data-row="pts" data-col="position" value="0"
                                    min="0"></td>
                            <td><input type="number" class="staff-vacancy" data-row="pts" readonly value="0"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- PRE CHECK Section -->
            <div class="section">
                <div class="section-title">Pre Check</div>
                <table>
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Count</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Male</strong></td>
                            <td><input type="number" id="preCheckMale" class="precheck-input" value="0" min="0"></td>
                        </tr>
                        <tr>
                            <td><strong>Female</strong></td>
                            <td><input type="number" id="preCheckFemale" class="precheck-input" value="0" min="0"></td>
                        </tr>
                        <tr>
                            <td><strong>Child</strong></td>
                            <td><input type="number" id="preCheckChild" class="precheck-input" value="0" min="0"></td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>TOTAL</strong></td>
                            <td><input type="number" id="preCheckTotal" readonly value="0"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- POST CHECK Section -->
            <div class="section">
                <div class="section-title">Post Check</div>
                <table>
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Count</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Male</strong></td>
                            <td><input type="number" id="postCheckMale" class="postcheck-input" value="0" min="0"></td>
                        </tr>
                        <tr>
                            <td><strong>Female</strong></td>
                            <td><input type="number" id="postCheckFemale" class="postcheck-input" value="0" min="0">
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Child</strong></td>
                            <td><input type="number" id="postCheckChild" class="postcheck-input" value="0" min="0"></td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>TOTAL</strong></td>
                            <td><input type="number" id="postCheckTotal" readonly value="0"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- NCD FOLLOW UP Section -->
            <div class="section">
                <div class="section-title">NCD Follow Up</div>
                <table>
                    <thead>
                        <tr>
                            <th>Condition</th>
                            <th>Male</th>
                            <th>Female</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>HT (Hypertension)</strong></td>
                            <td><input type="number" class="ncd-input" data-row="ht" data-col="male" value="0" min="0">
                            </td>
                            <td><input type="number" class="ncd-input" data-row="ht" data-col="female" value="0"
                                    min="0"></td>
                            <td><input type="number" class="ncd-total" data-row="ht" readonly value="0"></td>
                        </tr>
                        <tr>
                            <td><strong>HD (Heart Disease)</strong></td>
                            <td><input type="number" class="ncd-input" data-row="hd" data-col="male" value="0" min="0">
                            </td>
                            <td><input type="number" class="ncd-input" data-row="hd" data-col="female" value="0"
                                    min="0"></td>
                            <td><input type="number" class="ncd-total" data-row="hd" readonly value="0"></td>
                        </tr>
                        <tr>
                            <td><strong>DM (Diabetes Mellitus)</strong></td>
                            <td><input type="number" class="ncd-input" data-row="dm" data-col="male" value="0" min="0">
                            </td>
                            <td><input type="number" class="ncd-input" data-row="dm" data-col="female" value="0"
                                    min="0"></td>
                            <td><input type="number" class="ncd-total" data-row="dm" readonly value="0"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="button-container">
                <button class="btn-calculate" onclick="calculateAll()">üìä Calculate All</button>
                <button class="btn-print" onclick="downloadPDF()">ÔøΩ Download PDF</button>
                <button class="btn-reset" onclick="resetForm()">üîÑ Reset Form</button>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script>
        $(document).ready(function () {
            // Auto-calculate on any input change
            $('.op-input, .staff-input, .precheck-input, .postcheck-input, .ncd-input').on('input', function () {
                calculateAll();
            });

            // Initialize calculations
            calculateAll();
        });

        function calculateAll() {
            calculateOPCensus();
            calculateStaffStrength();
            calculatePreCheck();
            calculatePostCheck();
            calculateNCD();
        }

        // OP Census Calculations
        function calculateOPCensus() {
            const rows = ['new', 'old', 'morning', 'evening'];
            let totalMale = 0, totalFemale = 0, totalChildren = 0;

            rows.forEach(row => {
                const male = parseInt($(`input.op-input[data-row="${row}"][data-col="male"]`).val()) || 0;
                const female = parseInt($(`input.op-input[data-row="${row}"][data-col="female"]`).val()) || 0;
                const children = parseInt($(`input.op-input[data-row="${row}"][data-col="children"]`).val()) || 0;
                const rowTotal = male + female + children;

                $(`input.op-total[data-row="${row}"]`).val(rowTotal);

                totalMale += male;
                totalFemale += female;
                totalChildren += children;
            });

            $('#opMaleTotal').val(totalMale);
            $('#opFemaleTotal').val(totalFemale);
            $('#opChildrenTotal').val(totalChildren);
            $('#opGrandTotal').val(totalMale + totalFemale + totalChildren);
        }

        // Staff Strength Calculations
        function calculateStaffStrength() {
            const rows = ['no1', 'no', 'lsgd', 'nonhm', 'na', 'g2', 'g2hmc', 'pts'];

            rows.forEach(row => {
                const sanctioned = parseInt($(`input.staff-input[data-row="${row}"][data-col="sanctioned"]`).val()) || 0;
                const position = parseInt($(`input.staff-input[data-row="${row}"][data-col="position"]`).val()) || 0;
                const vacancy = sanctioned - position;

                $(`input.staff-vacancy[data-row="${row}"]`).val(vacancy >= 0 ? vacancy : 0);
            });
        }

        // Pre Check Calculations
        function calculatePreCheck() {
            const male = parseInt($('#preCheckMale').val()) || 0;
            const female = parseInt($('#preCheckFemale').val()) || 0;
            const child = parseInt($('#preCheckChild').val()) || 0;

            $('#preCheckTotal').val(male + female + child);
        }

        // Post Check Calculations
        function calculatePostCheck() {
            const male = parseInt($('#postCheckMale').val()) || 0;
            const female = parseInt($('#postCheckFemale').val()) || 0;
            const child = parseInt($('#postCheckChild').val()) || 0;

            $('#postCheckTotal').val(male + female + child);
        }

        // NCD Follow Up Calculations
        function calculateNCD() {
            const rows = ['ht', 'hd', 'dm'];

            rows.forEach(row => {
                const male = parseInt($(`input.ncd-input[data-row="${row}"][data-col="male"]`).val()) || 0;
                const female = parseInt($(`input.ncd-input[data-row="${row}"][data-col="female"]`).val()) || 0;

                $(`input.ncd-total[data-row="${row}"]`).val(male + female);
            });
        }

        // Download PDF Function - Professional Design
        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const month = $('#reportMonth').val() || 'DECEMBER';
            const year = $('#reportYear').val() || '2026';

            // Add professional border to page
            doc.setLineWidth(0.5);
            doc.rect(8, 8, 194, 279);

            // Header with professional styling
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(18);
            doc.text('FHC THONNAKKAL', 105, 16, { align: 'center' });

            // Underline for header
            doc.setLineWidth(0.3);
            doc.line(60, 18, 150, 18);

            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text(`MONTHLY REPORT ON  ${month.toUpperCase()} ${year}`, 105, 24, { align: 'center' });

            let yPos = 32;

            // OP CENSUS Section
            doc.setFontSize(11);
            doc.setFont('helvetica', 'bold');
            doc.setFillColor(240, 240, 240);
            doc.rect(12, yPos - 4, 186, 6, 'F');
            doc.setTextColor(0, 0, 0);
            doc.text('OP CENSUS', 14, yPos);
            yPos += 4;

            // Calculate totals for specialized PDF grouping
            const newTotal = parseInt($('input.op-total[data-row="new"]').val()) || 0;
            const oldTotal = parseInt($('input.op-total[data-row="old"]').val()) || 0;
            const mornTotal = parseInt($('input.op-total[data-row="morning"]').val()) || 0;
            const evenTotal = parseInt($('input.op-total[data-row="evening"]').val()) || 0;

            const opData = [
                ['', 'NEW OP', 'OLD OP', 'MORNING OP', 'EVENING OP'],
                [
                    'MALE',
                    $('input.op-input[data-row="new"][data-col="male"]').val() || '0',
                    $('input.op-input[data-row="old"][data-col="male"]').val() || '0',
                    $('input.op-input[data-row="morning"][data-col="male"]').val() || '0',
                    $('input.op-input[data-row="evening"][data-col="male"]').val() || '0'
                ],
                [
                    'FEMALE',
                    $('input.op-input[data-row="new"][data-col="female"]').val() || '0',
                    $('input.op-input[data-row="old"][data-col="female"]').val() || '0',
                    $('input.op-input[data-row="morning"][data-col="female"]').val() || '0',
                    $('input.op-input[data-row="evening"][data-col="female"]').val() || '0'
                ],
                [
                    'CHILDREN',
                    $('input.op-input[data-row="new"][data-col="children"]').val() || '0',
                    $('input.op-input[data-row="old"][data-col="children"]').val() || '0',
                    $('input.op-input[data-row="morning"][data-col="children"]').val() || '0',
                    $('input.op-input[data-row="evening"][data-col="children"]').val() || '0'
                ],
                [
                    'TOTAL',
                    newTotal,
                    oldTotal,
                    mornTotal,
                    evenTotal
                ],
                [
                    'GRAND TOTAL',
                    { content: (newTotal + oldTotal).toString(), colSpan: 2, styles: { halign: 'center' } },
                    { content: (mornTotal + evenTotal).toString(), colSpan: 2, styles: { halign: 'center' } }
                ]
            ];

            doc.autoTable({
                startY: yPos,
                head: [opData[0]],
                body: opData.slice(1),
                theme: 'grid',
                styles: {
                    fontSize: 9,
                    cellPadding: 1.5,
                    lineWidth: 0.2,
                    lineColor: [100, 100, 100]
                },
                headStyles: {
                    fillColor: [220, 220, 220],
                    textColor: [0, 0, 0],
                    fontStyle: 'bold',
                    halign: 'center',
                    fontSize: 9
                },
                bodyStyles: {
                    textColor: [0, 0, 0]
                },
                columnStyles: {
                    0: { fontStyle: 'bold', halign: 'left', cellWidth: 30 },
                    1: { halign: 'center', cellWidth: 30 },
                    2: { halign: 'center', cellWidth: 30 },
                    3: { halign: 'center', cellWidth: 30 },
                    4: { halign: 'center', cellWidth: 30 }
                },
                didParseCell: function (data) {
                    // Highlight TOTAL and GRAND TOTAL rows
                    if (data.row.index === 3 || data.row.index === 4) {
                        data.cell.styles.fillColor = [230, 230, 230];
                        data.cell.styles.fontStyle = 'bold';
                    }
                },
                margin: { left: 12, right: 12 }
            });

            yPos = doc.lastAutoTable.finalY + 5;

            // STAFF STRENGTH Section
            doc.setFont('helvetica', 'bold');
            doc.setFillColor(240, 240, 240);
            doc.rect(12, yPos - 4, 186, 6, 'F');
            doc.text('STAFF STRENGTH', 14, yPos);
            yPos += 4;

            const staffData = [
                ['CATEGORY OF STAFF', 'SANCTIONED POST', 'IN POSITION', 'VACCANCY'],
                ['NURSING OFFICER GRADE 1', $('input.staff-input[data-row="no1"][data-col="sanctioned"]').val() || '0', $('input.staff-input[data-row="no1"][data-col="position"]').val() || '0', $('input.staff-vacancy[data-row="no1"]').val() || '0'],
                ['NURSING OFFICER', $('input.staff-input[data-row="no"][data-col="sanctioned"]').val() || '0', $('input.staff-input[data-row="no"][data-col="position"]').val() || '0', $('input.staff-vacancy[data-row="no"]').val() || '0'],
                ['NURSING OFFICER LSGD', $('input.staff-input[data-row="lsgd"][data-col="sanctioned"]').val() || '0', $('input.staff-input[data-row="lsgd"][data-col="position"]').val() || '0', $('input.staff-vacancy[data-row="lsgd"]').val() || '0'],
                ['NURSING OFFICER NHM', $('input.staff-input[data-row="nonhm"][data-col="sanctioned"]').val() || '0', $('input.staff-input[data-row="nonhm"][data-col="position"]').val() || '0', $('input.staff-vacancy[data-row="nonhm"]').val() || '0'],
                ['NURSING ASSISSTANT', $('input.staff-input[data-row="na"][data-col="sanctioned"]').val() || '0', $('input.staff-input[data-row="na"][data-col="position"]').val() || '0', $('input.staff-vacancy[data-row="na"]').val() || '0'],
                ['GRADE II', $('input.staff-input[data-row="g2"][data-col="sanctioned"]').val() || '0', $('input.staff-input[data-row="g2"][data-col="position"]').val() || '0', $('input.staff-vacancy[data-row="g2"]').val() || '0'],
                ['GRADE II HMC', $('input.staff-input[data-row="g2hmc"][data-col="sanctioned"]').val() || '0', $('input.staff-input[data-row="g2hmc"][data-col="position"]').val() || '0', $('input.staff-vacancy[data-row="g2hmc"]').val() || '0'],
                ['PTS', $('input.staff-input[data-row="pts"][data-col="sanctioned"]').val() || '0', $('input.staff-input[data-row="pts"][data-col="position"]').val() || '0', $('input.staff-vacancy[data-row="pts"]').val() || '0']
            ];

            doc.autoTable({
                startY: yPos,
                head: [staffData[0]],
                body: staffData.slice(1),
                theme: 'grid',
                styles: {
                    fontSize: 9,
                    cellPadding: 1.5,
                    lineWidth: 0.2,
                    lineColor: [100, 100, 100]
                },
                headStyles: {
                    fillColor: [220, 220, 220],
                    textColor: [0, 0, 0],
                    fontStyle: 'bold',
                    halign: 'center',
                    fontSize: 9
                },
                bodyStyles: {
                    textColor: [0, 0, 0]
                },
                columnStyles: {
                    0: { halign: 'left', cellWidth: 70 },
                    1: { halign: 'center', cellWidth: 40 },
                    2: { halign: 'center', cellWidth: 38 },
                    3: { halign: 'center', cellWidth: 38 }
                },
                margin: { left: 12, right: 12 }
            });

            yPos = doc.lastAutoTable.finalY + 5;

            // PRE CHECK and POST CHECK side by side with professional headers
            const leftTableX = 12;
            const rightTableX = 105;

            // PRE CHECK (Left side)
            doc.setFont('helvetica', 'bold');
            doc.setFillColor(240, 240, 240);
            doc.rect(leftTableX, yPos - 4, 85, 6, 'F');
            doc.text('PRE CHECK', leftTableX + 2, yPos);

            const preCheckData = [
                ['MALE', $('#preCheckMale').val() || '0'],
                ['FEMALE', $('#preCheckFemale').val() || '0'],
                ['CHILD', $('#preCheckChild').val() || '0'],
                ['TOTAL', $('#preCheckTotal').val() || '0']
            ];

            doc.autoTable({
                startY: yPos + 2,
                body: preCheckData,
                theme: 'grid',
                styles: {
                    fontSize: 9,
                    cellPadding: 1.5,
                    lineWidth: 0.2,
                    lineColor: [100, 100, 100]
                },
                bodyStyles: {
                    textColor: [0, 0, 0]
                },
                columnStyles: {
                    0: { fontStyle: 'bold', cellWidth: 42, halign: 'left' },
                    1: { cellWidth: 42, halign: 'center' }
                },
                didParseCell: function (data) {
                    // Highlight TOTAL row
                    if (data.row.index === 3) {
                        data.cell.styles.fillColor = [230, 230, 230];
                        data.cell.styles.fontStyle = 'bold';
                    }
                },
                margin: { left: leftTableX }
            });

            // POST CHECK (Right side)
            doc.setFont('helvetica', 'bold');
            doc.setFillColor(240, 240, 240);
            doc.rect(rightTableX, yPos - 4, 85, 6, 'F');
            doc.text('POST CHECK', rightTableX + 2, yPos);

            const postCheckData = [
                ['MALE', $('#postCheckMale').val() || '0'],
                ['FEMALE', $('#postCheckFemale').val() || '0'],
                ['CHILD', $('#postCheckChild').val() || '0'],
                ['TOTAL', $('#postCheckTotal').val() || '0']
            ];

            doc.autoTable({
                startY: yPos + 2,
                body: postCheckData,
                theme: 'grid',
                styles: {
                    fontSize: 9,
                    cellPadding: 1.5,
                    lineWidth: 0.2,
                    lineColor: [100, 100, 100]
                },
                bodyStyles: {
                    textColor: [0, 0, 0]
                },
                columnStyles: {
                    0: { fontStyle: 'bold', cellWidth: 42, halign: 'left' },
                    1: { cellWidth: 42, halign: 'center' }
                },
                didParseCell: function (data) {
                    // Highlight TOTAL row
                    if (data.row.index === 3) {
                        data.cell.styles.fillColor = [230, 230, 230];
                        data.cell.styles.fontStyle = 'bold';
                    }
                },
                margin: { left: rightTableX }
            });

            yPos = Math.max(doc.lastAutoTable.finalY, yPos + 2 + (preCheckData.length * 6)) + 5;

            // NCD FOLLOW UP Section
            doc.setFont('helvetica', 'bold');
            doc.setFillColor(240, 240, 240);
            doc.rect(12, yPos - 4, 186, 6, 'F');
            doc.text('NCD FOLLOW UP', 14, yPos);
            yPos += 4;

            const ncdData = [
                ['', 'MALE', 'FEMALE', 'TOTAL'],
                ['HT', $('input.ncd-input[data-row="ht"][data-col="male"]').val() || '0', $('input.ncd-input[data-row="ht"][data-col="female"]').val() || '0', $('input.ncd-total[data-row="ht"]').val() || '0'],
                ['HD', $('input.ncd-input[data-row="hd"][data-col="male"]').val() || '0', $('input.ncd-input[data-row="hd"][data-col="female"]').val() || '0', $('input.ncd-total[data-row="hd"]').val() || '0'],
                ['DM', $('input.ncd-input[data-row="dm"][data-col="male"]').val() || '0', $('input.ncd-input[data-row="dm"][data-col="female"]').val() || '0', $('input.ncd-total[data-row="dm"]').val() || '0']
            ];

            doc.autoTable({
                startY: yPos,
                head: [ncdData[0]],
                body: ncdData.slice(1),
                theme: 'grid',
                styles: {
                    fontSize: 9,
                    cellPadding: 1.5,
                    lineWidth: 0.2,
                    lineColor: [100, 100, 100]
                },
                headStyles: {
                    fillColor: [220, 220, 220],
                    textColor: [0, 0, 0],
                    fontStyle: 'bold',
                    halign: 'center',
                    fontSize: 9
                },
                bodyStyles: {
                    textColor: [0, 0, 0]
                },
                columnStyles: {
                    0: { fontStyle: 'bold', halign: 'left' },
                    1: { halign: 'center' },
                    2: { halign: 'center' },
                    3: { halign: 'center' }
                },
                margin: { left: 12, right: 12 }
            });

            // Footer with date
            const finalY = doc.lastAutoTable.finalY;
            doc.setFontSize(8);
            doc.setFont('helvetica', 'italic');
            doc.setTextColor(100, 100, 100);
            doc.text(`Generated on: ${new Date().toLocaleDateString('en-IN', { day: '2-digit', month: 'short', year: 'numeric' })}`, 14, 285);
            doc.text('Page 1 of 1', 190, 285, { align: 'right' });

            // Save the PDF
            doc.save(`Monthly_Report_${month}_${year}.pdf`);
        }

        // Reset Form
        function resetForm() {
            if (confirm('Are you sure you want to reset all data? This cannot be undone.')) {
                $('input[type="number"]').val(0);
                $('#reportMonth').val('DECEMBER');
                $('#reportYear').val('2026');
                calculateAll();
            }
        }

        // Prevent negative values
        $('input[type="number"]').on('input', function () {
            if ($(this).val() < 0) {
                $(this).val(0);
            }
        });
    </script>
    <script>
        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
</body>

</html>